<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0,user-scalable=no">
    <title>发现详情2.0</title>
    <link rel="stylesheet" href="../css/reset.css">
    <link rel="stylesheet" href="../css/swiper-3.4.2.min.css">
    <!--引入上拉加载插件css-->
    <link rel="stylesheet" href="../css/mescroll.min.css">
    <!--需要修改引入对应的css-->
    <link rel="stylesheet" href="../css/discoverDetails2.0.css">
    <!--需要修改引入对应的css-->

</head>
<body>
<div class="disDetWrapper">
    <!--发现详情头部-->
    <!--  <div class="navDis">
           <img src="../images/btn_nav_jump@2x.png" alt="" class="iconBack">
          <img src="../images/btn_nav_more@2x.png" alt="" class="iconMore">
          发现详情
      </div>-->
    <!--详情内容-->
    <div class="details">
        <p class="detailsText">
            老子吃火锅你吃火锅底料对你笑呵呵因为我讲礼貌你 笑呵呵因为我讲礼貌你 笑呵呵因为我讲礼貌
        </p>
        <p class="information">
            2017-08-24<span></span>来自护肤心得
        </p>
        <div class="userHeader clearfix">
            <div class="userImg">
                <!--<img src="../images/userImg01.png" alt="">-->
            </div>
            <p class="userMessage">
                Bridge
                <!--<img src="../images/icon_grade-level@2x.png" alt="">

                <span class="levelNum">
                2
            </span>-->
            </p>
            <p class="userText">
                美丽知识分享达人
            </p>
            <div class="follow">
                        <span class="followImg">
                            <img src="../images/btn_one_n@2x.png" alt="">
                        </span>
                <span class="fllowTest">关注</span>
            </div>
        </div>
    </div>
    <div class="goodsShow" style="display: none">
        <div class="goods">
            <div class="goodsImg">
                <img src="../images/goodsImg.png" alt="">
            </div>
            <div class="goodsMsg">
                <p class="goodsName">奥玛生机商品名称最多十五个字吧称最多十五称最多十五</p>
                <p class="price">¥<i>1980</i><span>查看详情>></span></p>
            </div>
        </div>
    </div>
    <!--图文介绍-->
    <div class="goodsIntroduce">
        <p>
            老子吃火锅你吃火锅底料,对你笑呵呵,因为我讲礼貌狠货有好多,个人拿去比较,包包头摸摸,这个月才几号。
        </p>
        <p>都不要闹,来跟到跳,一口咬下去油汤汤都跟到冒,来比哈燥脸高头笑,Gosh都悠然自得,烟雾心头绕绕绕都聪明惨咯嘛。</p>
        <img src="../images/introduceImg.png" alt="">
        <p>老子吃火锅你吃火锅底料,对你笑呵呵,因为我讲礼貌狠货有好多,个人拿去比较,包包头摸摸,这个月才几号。   </p>
    </div>
    <!--评论-->
    <div id="mescroll" class="mescroll">
        <div class="comment">
            <p class="commentHead">
                评论 (3)
                <span>
                        <i class="new active" i="0">最新</i>
                        <i class="hot" i="1">最热</i>
                    </span>
            </p>
            <ul class="comList" id="dataList">
                <!--  <li>
                      <div class="comItem">
                          <div class="userListHeader">
                              <div class="userHeader clearfix">
                                  <div class="userImg">
                                      <img src="../images/customer02.png" alt="">
                                  </div>
                                  <p class="like">
                                      <img src="../images/icon_Give_the_thumbs_up_n@2x.png" alt="">
                                      <i>213</i>
                                  </p>
                                  <p class="userMessage">Bridge<img src="../images/icon_grade-level@2x.png" alt=""><span class="levelNum">2</span></p>
                                  <p class="userText">2017-08-25  18:20</p>
                              </div>
                          </div>
                          <p class="comContent">
                              老子吃火锅你吃火锅底料,对你笑呵呵,因为我讲礼貌狠货有好多,个人拿去比较,包包头摸摸这个月才几号。
                          </p>
                          <div class="replyStyle">
                              <ul class="replyList" style="display: none">
                                  <li class="replyItem">
                                      <span class="userName">妹妹<i>：</i></span>为保长城不倒，烈马长枪握好，眼看时间不早，对的起江东父老。
                                  </li>
                                  <ul class="replyList" style="display: block">
                                      <li class="replyItem">
                                          <span class="userName"><span>姐姐</span><i class="return">回复</i><span>妹妹</span><i>：</i></span>一往无前虎山行，拨开云雾见光明，梦里花开牡丹亭，幻想成真歌舞升平。
                                      </li>
                                  </ul>
                              </ul>
                          </div>
                          <div class="lookforAllReply" style="display: block">
                              查看全部回复
                              <img src="../images/rightTwo.png" alt="">
                          </div>
                      </div>
                  </li>-->
            </ul>

        </div>
    </div>

    <!--loading图-->
    <!-- <div class="loading">
         好棒，内容都被你看光光了～
     </div>-->
    <!--footer-->
    <footer>
        <input type="text" placeholder="写的好卖力，且评且珍惜">
        <div class="collect">
            <img src="../images/icon_shoucang_n@2x.png" alt="">
            <i>收藏</i>
        </div>
        <div class="like">
            <img src="../images/icon_Give_the_thumbs_up_n@2x.png" alt="">
            <i>200</i>
        </div>
    </footer>
    <!--回到顶部-->
    <div class="goTop">
        <img src="../images/btn_Back_to_the_top@2x.png" alt="">
    </div>
</div>

<script type="text/javascript" src="../js/rem.js"></script>
<script type="text/javascript" src="../js/jquery.min.js"></script>
<script type="text/javascript" src="../js/swiper-3.4.2.jquery.min.js"></script>
<!--引入下拉加载插件js-->
<script type="text/javascript" src="../js/mescroll.min.js"></script>
<script type="text/javascript">
    $(function(){
        /****************************************************************************/
        //是否为ios设备;
        var isIOS = !!navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/); //ios终端
        //是否为PC端,如果是scrollbar端,默认自定义滚动条
        var isPC = typeof window.orientation == 'undefined' ;
        //创建MeScroll对象,内部已默认开启下拉刷新,自动执行up.callback,刷新列表数据;
        var mescroll = new MeScroll("mescroll", {
            //下拉刷新的所有配置项
            down:{
                use: false, //是否初始化下拉刷新; 默认true
                auto: true, //是否在初始化完毕之后自动执行下拉回调callback; 默认true
                /*autoShowLoading: false, //如果在初始化完毕之后自动执行下拉回调,是否显示下拉刷新进度; 默认false
                 isLock: false, //是否锁定下拉,默认false;
                 isBoth: false, //下拉刷新时,如果滑动到列表底部是否可以同时触发上拉加载;默认false,两者不可同时触发;*/
                callback: function(mescroll) {
                    //加载轮播数据
                    //loadSwiper();
                    //下拉刷新的回调,默认重置上拉加载列表为第一页
                    mescroll.resetUpScroll();
                },
                /*offset: 60, //触发刷新的距离,默认80
                 outOffsetRate: 0.2, //超过指定距离范围外时,改变下拉区域高度比例;值小于1且越接近0,越往下拉高度变化越小;
                 bottomOffset: 20, //当手指touchmove位置在距离body底部20px范围内的时候结束上拉刷新,避免Webview嵌套导致touchend事件不执行
                 minAngle: 45, //向下滑动最少偏移的角度,取值区间  [0,90];默认45度,即向下滑动的角度大于45度则触发下拉;而小于45度,将不触发下拉,避免与左右滑动的轮播等组件冲突;
                 mustToTop: !isIOS, //是否列表必须滑动到顶部才能下拉;因为列表回弹效果(-webkit-overflow-scrolling:touch)是iOS专属样式,所以iOS默认false,其他为true;
                 hardwareClass: "mescroll-hardware", //硬件加速样式;解决iOS下拉因隐藏进度条而闪屏的问题,参见mescroll.css
                 warpId: null, //可配置下拉刷新的布局添加到指定id的div;默认不配置,默认添加到mescrollId
                 warpClass: "mescroll-downwarp", //容器,装载布局内容,参见mescroll.css
                 resetClass: "mescroll-downwarp-reset", //高度重置的动画,参见mescroll.css
                 htmlContent: '<p class="downwarp-progress"></p><p class="downwarp-tip">下拉刷新 </p>', //布局内容*/
                /*inited: function(mescroll, downwarp) {
                 console.log("down --> inited");
                 //初始化完毕的回调,可缓存dom
                 mescroll.downTipDom = downwarp.getElementsByClassName("downwarp-tip")[0];
                 mescroll.downProgressDom = downwarp.getElementsByClassName("downwarp-progress")[0];
                 },
                 inOffset: function(mescroll) {
                 console.log("down --> inOffset");
                 //进入指定距离offset范围内那一刻的回调
                 if(mescroll.downTipDom) mescroll.downTipDom.innerHTML = "下拉刷新";
                 if(mescroll.downProgressDom) mescroll.downProgressDom.classList.remove("mescroll-rotate");
                 },
                 outOffset: function(mescroll) {
                 console.log("down --> outOffset");
                 //下拉超过指定距离offset那一刻的回调
                 if(mescroll.downTipDom) mescroll.downTipDom.innerHTML = "释放更新";
                 },
                 onMoving: function(mescroll, rate, downHight) {
                 //下拉过程中的回调,滑动过程一直在执行; rate下拉区域当前高度与指定距离offset的比值(inOffset: rate<1; outOffset: rate>=1); downHight当前下拉区域的高度
                 console.log("down --> onMoving --> mescroll.optDown.offset="+mescroll.optDown.offset+", downHight="+downHight+", rate="+rate);
                 if(mescroll.downProgressDom) {
                 var progress = 360 * rate;
                 mescroll.downProgressDom.style.webkitTransform = "rotate(" + progress + "deg)";
                 mescroll.downProgressDom.style.transform = "rotate(" + progress + "deg)";
                 }
                 },
                 beforeLoading: function(mescroll, downwarp) {
                 console.log("down --> beforeLoading");
                 //准备触发下拉刷新的回调
                 return false; //如果要完全自定义下拉刷新,那么return true,此时将不再执行showLoading(),callback();
                 },*/
                /*showLoading: function(mescroll) {
                 console.log("down --> showLoading");
                 //触发下拉刷新的回调
                 if(mescroll.downTipDom) mescroll.downTipDom.innerHTML = "加载中 ...";
                 if(mescroll.downProgressDom) mescroll.downProgressDom.classList.add("mescroll-rotate");
                 }*/
            },
            //上拉加载的所有配置项
            up: {
                use: true, //是否初始化上拉加载; 默认true
                auto: false, //是否在初始化时以上拉加载的方式自动加载第一页数据; 默认false
                isLock: false, //是否锁定上拉,默认false;当列表没有更多数据时会自动锁定不可上拉;在endSuccess如果检查到有下一页数据,则会自动解锁true
                isBoth: true, //上拉加载时,如果滑动到列表顶部是否可以同时触发下拉刷新;默认false,两者不可同时触发; 这里为了演示改为true,不必等列表加载完毕才可下拉;
                callback: getListData, //上拉回调,此处可简写; 相当于 callback: function (page, mescroll) { getListData(page); }
                page: {
                    num: 0, //当前页 默认0,回调之前会加1; 即callback(page)会从1开始
                    size: 12, //每页数据条数
                    time: null //加载第一页数据服务器返回的时间; 防止用户翻页时,后台新增了数据从而导致下一页数据重复;
                },
                noMoreSize: 5, //如果列表已无数据,可设置列表的总数量要大于半页才显示无更多数据;避免列表数据过少(比如只有一条数据),显示无更多数据会不好看
                offset: 100, //离底部的距离
                toTop: {
                    //回到顶部按钮,需配置src才显示
//						src: "../res/img/mescroll-totop.png", //图片路径,默认null;
                    offset: 1000, //列表滚动多少距离才显示回到顶部按钮,默认1000
                    warpClass: "mescroll-totop", //按钮样式,参见mescroll.css
                    showClass: "mescroll-fade-in", //显示样式,参见mescroll.css
                    hideClass: "mescroll-fade-out", //隐藏样式,参见mescroll.css
                    duration: 300 //回到顶部的动画时长,默认300ms
                },
                loadFull: {
                    use: false, //列表数据过少,不足以滑动触发上拉加载,是否自动加载下一页,直到满屏或者无更多数据为止;默认false,因为可通过调高page.size避免这个情况
                    delay: 500 //延时执行的毫秒数; 延时是为了保证列表数据或占位的图片都已初始化完成,且下拉刷新上拉加载中区域动画已执行完毕;
                },
                empty: {
                    //列表第一页无任何数据时,显示的空提示布局; 需配置warpId或clearEmptyId才生效;
                    warpId:null, //父布局的id; 如果此项有值,将不使用clearEmptyId的值;
                    icon: "../res/img/mescroll-empty.png", //图标,默认null
                    tip: "暂无相关数据~", //提示
                    btntext: "去逛逛 >", //按钮,默认""
                    btnClick: function(){//点击按钮的回调,默认null
                        alert("点击了按钮,具体逻辑自行实现");
                    }
                },
                clearId: null, //加载第一页时需清空数据的列表id; 如果此项有值,将不使用clearEmptyId的值;
                clearEmptyId: "dataList", //相当于同时设置了clearId和empty.warpId; 简化写法;
                hardwareClass: "mescroll-hardware", //硬件加速样式,动画更流畅,参见mescroll.css
                warpId: null, //可配置上拉加载的布局添加到指定id的div;默认不配置,默认添加到mescrollId
                warpClass: "mescroll-upwarp", //容器,装载布局内容,参见mescroll.css
                htmlLoading: '<p class="upwarp-progress mescroll-rotate"></p><p class="upwarp-tip">哈哈你看我出来不</p>', //上拉加载中的布局
                htmlNodata: '<p class="upwarp-nodata">-- 真棒加载完了 --</p>', //无数据的布局
                inited: function(mescroll, upwarp) {
                    console.log("up --> inited");
                    //初始化完毕的回调,可缓存dom 比如 mescroll.upProgressDom = upwarp.getElementsByClassName("upwarp-progress")[0];
                },
                showLoading: function(mescroll, upwarp) {
                    console.log("up --> showLoading");
                    //上拉加载中.. mescroll.upProgressDom.style.display = "block" 不通过此方式显示,因为ios快速滑动到底部,进度条会无法及时渲染
                    upwarp.innerHTML = mescroll.optUp.htmlLoading;
                },
                showNoMore: function(mescroll, upwarp) {
                    console.log("up --> showNoMore");
                    //无更多数据
                    upwarp.innerHTML = mescroll.optUp.htmlNodata;
                },
                onScroll: function(mescroll, y, isUp){ //列表滑动监听,默认onScroll: null;
                    //y为列表当前滚动条的位置
                    console.log("up --> onScroll 列表当前滚动的距离 y = " + y + ", 是否向上滑动 isUp = " + isUp);
                },
                scrollbar: {
                    use: isPC, //默认只在PC端自定义滚动条样式
                    barClass: "mescroll-bar"
                }
            }
        });

        /*初始化菜单*/
        var pdType=0;//全部商品0; 奶粉1; 图书2;
        $(".commentHead>span>i").click(function(){
            var i=$(this).attr("i");
            if(pdType!=i) {
                //更改列表条件
                pdType=i;
                $(".commentHead>span>.active").removeClass("active");
                $(this).addClass("active");
                //重置列表数据
                mescroll.resetUpScroll();
            }
        })

        /*联网加载列表数据  page = {num:1, size:10}; num:当前页 从1开始, size:每页数据条数 */
        function getListData(page){
            //联网加载数据
            getListDataFromNet(pdType, page.num, page.size, function(curPageData){
                //联网成功的回调,隐藏下拉刷新和上拉加载的状态;
                //mescroll会根据传的参数,自动判断列表如果无任何数据,则提示空;列表无下一页数据,则提示无更多数据;
                console.log("pdType="+pdType+", page.num="+page.num+", page.size="+page.size+", curPageData.length="+curPageData.length);
                console.log(curPageData)

                //方法一(推荐): 后台接口有返回列表的总页数 totalPage
                //mescroll.endByPage(curPageData.length, totalPage); //必传参数(当前页的数据个数, 总页数)

                //方法二(推荐): 后台接口有返回列表的总数据量 totalSize
                //mescroll.endBySize(curPageData.length, totalSize); //必传参数(当前页的数据个数, 总数据量)

                //方法三(推荐): 您有其他方式知道是否有下一页 hasNext
                //mescroll.endSuccess(curPageData.length, hasNext); //必传参数(当前页的数据个数, 是否有下一页true/false)

                //方法四 (不推荐),会存在一个小问题:比如列表共有20条数据,每页加载10条,共2页.如果只根据当前页的数据个数判断,则需翻到第三页才会知道无更多数据,如果传了hasNext,则翻到第二页即可显示无更多数据.
                mescroll.endSuccess(curPageData.length);

                //设置列表数据
                setListData(curPageData);
            }, function(){
                //联网失败的回调,隐藏下拉刷新和上拉加载的状态;
                mescroll.endErr();
            });
        }

        /*设置列表数据*/
        function setListData(curPageData){
            var listDom=document.getElementById("dataList");
            for (var i = 0; i < curPageData.length; i++) {
                var pd=curPageData[i];

                var str='<img class="pd-img" src="'+pd.pdImg+'"/>';
                str+='<p class="pd-name">'+pd.pdName+'</p>';
                str+='<p class="pd-price">'+pd.pdPrice+' 元</p>';
                str+='<p class="pd-sold">已售'+pd.pdSold+'件</p>';

                var liDom=document.createElement("li");
                liDom.innerHTML=str;
                listDom.appendChild(liDom);
            }
        }

        /*联网加载列表数据*/
        function getListDataFromNet(pdType,pageNum,pageSize,successCallback,errorCallback) {
            //延时一秒,模拟联网
            setTimeout(function () {
                $.ajax({
                    type: 'GET',
                    url: '../json/pdlist1.json',
//		                url: '../res/pdlist1.json?pdType='+pdType+'&num='+pageNum+'&size='+pageSize,
                    dataType: 'json',
                    success: function(data){
                        var listData=[];

                        //pdType 全部商品0; 奶粉1; 图书2;
                        if(pdType==0){
                            //全部商品 (模拟分页数据)
                            for (var i = (pageNum-1)*pageSize; i < pageNum*pageSize; i++) {
                                if(i==data.length) break;
                                listData.push(data[i]);
                            }

                        }else if(pdType==1){
                            //奶粉
                            for (var i = 0; i < data.length; i++) {
                                if (data[i].pdName.indexOf("奶")!=-1) {
                                    listData.push(data[i]);
                                }
                            }

                        }else if(pdType==2){
                            //图书
                            for (var i = 0; i < data.length; i++) {
                                if (data[i].pdName.indexOf("图书")!=-1) {
                                    listData.push(data[i]);
                                }
                            }
                        }

                        //回调
                        successCallback(listData);
                    },
                    error: errorCallback
                });
            },1000)
        }

        //禁止PC浏览器拖拽图片,避免与下拉刷新冲突;如果仅在移动端使用,可删除此代码
        document.ondragstart=function() {return false;}
        /****************************************************************************/

        /*评论列表最新、最热切换*/
//        navSwitch()
        /*function navSwitch() {
         $('.commentHead>span>i:first-child').addClass('active')
         $('.commentHead>span>i').click(function () {
         $(this).siblings().removeClass('active')
         $(this).addClass('active')
         })
         }*/
        like()
        //点赞
        function like() {
            $('.like>img').click(function () {
                if($(this).next().hasClass('active')){
                    return
                }
                $(this).attr({src:'../images/icon_Give_the_thumbs_up@2x.png'}).next().text(parseInt($(this).next().text())+1)
                $(this).next().addClass('active')
            })
        }
        goTop()
        function goTop() {
            $('.goTop').click(function () {
                $(document).scrollTop(0);
            })
        }


    })
</script>
</body>
</html>